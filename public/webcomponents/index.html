<!doctype html>
<html>

<head>
<script type="text/javascript" src="/page/page.js"></script>
<script type="text/javascript" src="/components/d3/d3.min.js"></script>
<script type="text/javascript" src="/js/polyfill.min.js"></script>
<script type="text/javascript" src="/components/webcomponentsjs/webcomponents-lite.js"></script>
<link rel="import" href="/components/polymer/polymer-element.html">
</head>

<style>
  html, body {
    margin: 0;
  }
  #element {
    position: absolute;
    display: block;
    width: 100%;
    height: 100%;
  }
</style>


<body>
  <script>
    window.addEventListener('WebComponentsReady', function(e) {
      page('*', function(ctx, next) {
        var qs = Object.assign(...ctx.querystring.split("&").map(o=>o.split("=")).map(o=>({[o[0]]:o[1]})));
        var source = ctx.pathname;
        if(!source) {
          alert("잘못된 접근입니다.");
          return;
        }
        d3.request("/activities/" + source + ".json")
          .mimeType("application/json")
          .response(function(xhr) { return JSON.parse(xhr.responseText); })
          .get(function(activity) {
            var link = document.createElement('link');
            link.setAttribute('rel', 'import');
            link.setAttribute('href', '/webcomponents/' + activity.element + '.html');
            link.onload = function() {
              var comp = document.createElement(activity.element);
              comp.setAttribute('id', 'element');
              for(var key in activity.attributes) {
                comp.setAttribute(key, activity.attributes[key]);
              }
              document.body.appendChild(comp);
              comp.setData(activity.data, activity.manifest);
            };
            document.head.appendChild(link);
          });
      });
      page({
        hashbang: true
      });
    });
  </script>
  <!-- FIXME: puzzle.setVal(pzUrl, 3, 250) 부분 수정하기 -->
</body>

</html>
