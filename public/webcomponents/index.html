<!doctype html>
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
<script type="text/javascript" src="/page/page.js"></script>
<script type="text/javascript" src="/components/d3/d3.min.js"></script>
<script type="text/javascript" src="/js/polyfill.min.js"></script>
<script type="text/javascript" src="/webcomponents/activity-devtool.js"></script>
<script type="text/javascript" src="/components/webcomponentsjs/webcomponents-lite.js"></script>
<script type="text/javascript" src="/components/SoundJS/lib/soundjs-0.6.2.min.js"></script>
<link rel="import" href="/components/polymer/polymer-element.html">
<link rel="import" href="/components/app-localize-behavior/app-localize-behavior.html">
</head>

<style>
  html, body {
    margin: 0;
    position: relative;
    height: 100%;
    overflow: hidden;
    touch-action:none;
    -ms-touch-action:none;
  }
  #element {
    overflow: hidden;
    position: relative;
    display: block;
    width: 100%;
    height: 100%;
  }
</style>


<body>
  <script>
    window.$$$$ = new actTool(document);
    page('*', function(ctx, next) {
      var qs = Object.assign(...ctx.querystring.split("&").map(o=>o.split("=")).map(o=>({[o[0]]:o[1]})));
      var source = ctx.pathname;
      if(!source) {
        alert("잘못된 접근입니다.");
        return;
      }
      d3.request("/activities/" + source + ".json")
        .mimeType("application/json")
        .response(function(xhr) { return JSON.parse(xhr.responseText); })
        .get(function(activity) {
          var link = document.createElement('link');
          link.setAttribute('rel', 'import');
          link.setAttribute('href', '/webcomponents/' + activity.element + '.html');
          link.onload = function() {
            customElements.whenDefined(activity.element).then(() => {
              var comp = document.createElement(activity.element);
              comp.setAttribute('id', 'element');
              if(qs.lang) {
                comp.setAttribute('language', qs.lang);
              }
              for(var key in activity.attributes) {
                comp.setAttribute(key, activity.attributes[key]);
                comp.set(key, activity.attributes[key]);
              }
              if(activity.msg) {
                comp.set('resources', activity.msg);
              }
              document.body.appendChild(comp);
              comp.setData(activity.data, activity.manifest);
            });
          };
          document.head.appendChild(link);
        });
    });
    page({
      hashbang: true
    });
  </script>
</body>

</html>
